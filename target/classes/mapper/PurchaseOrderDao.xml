<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xingji.frameproject.mybatis.dao.PurchaseOrderDao">
    <!-- 结果集 -->
    <resultMap type="com.xingji.frameproject.mybatis.entity.PurchaseOrder" id="PurchaseOrderMap">
        <result property="id" column="id" jdbcType="VARCHAR"/>
        <result property="deliceryDate" column="delicery_date" jdbcType="TIMESTAMP"/>
        <result property="vendorName" column="vendor_name" jdbcType="VARCHAR"/>
        <result property="documentsDate" column="documents_date" jdbcType="TIMESTAMP"/>
        <result property="vettingName" column="vetting_name" jdbcType="VARCHAR"/>
        <result property="disrate" column="disrate" jdbcType="NUMERIC"/>
        <result property="dismoney" column="dismoney" jdbcType="NUMERIC"/>
        <result property="offersPrice" column="offers_price" jdbcType="NUMERIC"/>
        <result property="orderState" column="order_state" jdbcType="INTEGER"/>
        <result property="depotName" column="depot_name" jdbcType="VARCHAR"/>
        <result property="receiptOrderId" column="receipt_order_id" jdbcType="VARCHAR"/>
        <result property="exitOrderId" column="exit_order_id" jdbcType="VARCHAR"/>
        <result property="paymentOrder" column="payment_order" jdbcType="VARCHAR"/>
        <result property="vettingState" column="vetting_state" jdbcType="INTEGER"/>
        <result property="lastVettingDate" column="last_vetting_date" jdbcType="TIMESTAMP"/>
        <result property="inboundState" column="inbound_state" jdbcType="INTEGER"/>
        <result property="buyerName" column="buyer_name" jdbcType="VARCHAR"/>
        <result property="createPeople" column="create_people" jdbcType="VARCHAR"/>
        <result property="createDate" column="create_date" jdbcType="TIMESTAMP"/>
        <result property="updateDate" column="update_date" jdbcType="TIMESTAMP"/>
        <result property="counter" column="counter" jdbcType="INTEGER"/>
        <result property="ostate" column="ostate" jdbcType="NUMERIC"/>
    </resultMap>

    <resultMap id="PurchaseReceipt" type="com.xingji.frameproject.vo.PurchaseCapitalVo">
        <result property="purchaseId" column="id" jdbcType="VARCHAR"/>
        <result property="purchaseTime" column="documents_date" jdbcType="TIMESTAMP"/>
        <result property="payableMoney" column="offers_price" jdbcType="NUMERIC"/>
        <result property="paidMoney" column="ostate" jdbcType="NUMERIC"/>
        <result property="unpaidMoney" column="offers_price-ostate" jdbcType="NUMERIC"/>
        <result property="vendor" column="vendor_name" jdbcType="VARCHAR"/>
    </resultMap>


    <!-- 基本字段 -->
    <sql id="Base_Column_List">
        id
        , delicery_date, vendor_name, documents_date, vetting_name, disrate, dismoney, offers_price, order_state, depot_name, receipt_order_id, exit_order_id, payment_order, vetting_state, last_vetting_date, inbound_state, buyer_name, create_people, create_date, update_date, counter, ostate    </sql>

    <!-- 查询单个 -->
    <select id="queryById" resultMap="PurchaseOrderMap">
        select
        <include refid="Base_Column_List"/>
        from purchase_order
        where id = #{id}
    </select>

    <!-- 查询全部 -->
    <select id="queryAll" resultMap="PurchaseOrderMap">
        select
        <include refid="Base_Column_List"/>
        from purchase_order
    </select>

    <!--通过实体作为筛选条件查询-->
    <select id="queryAndByPojo" resultMap="PurchaseOrderMap">
        select
        <include refid="Base_Column_List"/>
        from purchase_order
        <where>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
            <if test="deliceryDate != null">
                and delicery_date = #{deliceryDate}
            </if>
            <if test="vendorName != null and vendorName != ''">
                and vendor_name = #{vendorName}
            </if>
            <if test="documentsDate != null">
                and documents_date = #{documentsDate}
            </if>
            <if test="vettingName != null and vettingName != ''">
                and vetting_name = #{vettingName}
            </if>
            <if test="disrate != null">
                and disrate = #{disrate}
            </if>
            <if test="dismoney != null">
                and dismoney = #{dismoney}
            </if>
            <if test="offersPrice != null">
                and offers_price = #{offersPrice}
            </if>
            <if test="orderState != null">
                and order_state = #{orderState}
            </if>
            <if test="depotName != null and depotName != ''">
                and depot_name = #{depotName}
            </if>
            <if test="receiptOrderId != null and receiptOrderId != ''">
                and receipt_order_id = #{receiptOrderId}
            </if>
            <if test="exitOrderId != null and exitOrderId != ''">
                and exit_order_id = #{exitOrderId}
            </if>
            <if test="paymentOrder != null and paymentOrder != ''">
                and payment_order = #{paymentOrder}
            </if>
            <if test="vettingState != null">
                and vetting_state = #{vettingState}
            </if>
            <if test="lastVettingDate != null">
                and last_vetting_date = #{lastVettingDate}
            </if>
            <if test="inboundState != null">
                and inbound_state = #{inboundState}
            </if>
            <if test="buyerName != null and buyerName != ''">
                and buyer_name = #{buyerName}
            </if>
            <if test="createPeople != null and createPeople != ''">
                and create_people = #{createPeople}
            </if>
            <if test="createDate != null">
                and create_date = #{createDate}
            </if>
            <if test="updateDate != null">
                and update_date = #{updateDate}
            </if>
            <if test="counter != null">
                and counter = #{counter}
            </if>
            <if test="ostate != null">
                and ostate = #{ostate}
            </if>
        </where>
    </select>

    <!--通过实体作为筛选条件查询-->
    <select id="queryOrByPojo" resultMap="PurchaseOrderMap">
        select
        <include refid="Base_Column_List"/>
        from purchase_order
        <where>
            <if test="id != null and id != ''">
                or id = #{id}
            </if>
            <if test="deliceryDate != null">
                or delicery_date = #{deliceryDate}
            </if>
            <if test="vendorName != null and vendorName != ''">
                or vendor_name = #{vendorName}
            </if>
            <if test="documentsDate != null">
                or documents_date = #{documentsDate}
            </if>
            <if test="vettingName != null and vettingName != ''">
                or vetting_name = #{vettingName}
            </if>
            <if test="disrate != null">
                or disrate = #{disrate}
            </if>
            <if test="dismoney != null">
                or dismoney = #{dismoney}
            </if>
            <if test="offersPrice != null">
                or offers_price = #{offersPrice}
            </if>
            <if test="orderState != null">
                or order_state = #{orderState}
            </if>
            <if test="depotName != null and depotName != ''">
                or depot_name = #{depotName}
            </if>
            <if test="receiptOrderId != null and receiptOrderId != ''">
                or receipt_order_id = #{receiptOrderId}
            </if>
            <if test="exitOrderId != null and exitOrderId != ''">
                or exit_order_id = #{exitOrderId}
            </if>
            <if test="paymentOrder != null and paymentOrder != ''">
                or payment_order = #{paymentOrder}
            </if>
            <if test="vettingState != null">
                or vetting_state = #{vettingState}
            </if>
            <if test="lastVettingDate != null">
                or last_vetting_date = #{lastVettingDate}
            </if>
            <if test="inboundState != null">
                or inbound_state = #{inboundState}
            </if>
            <if test="buyerName != null and buyerName != ''">
                or buyer_name = #{buyerName}
            </if>
            <if test="createPeople != null and createPeople != ''">
                or create_people = #{createPeople}
            </if>
            <if test="createDate != null">
                or create_date = #{createDate}
            </if>
            <if test="updateDate != null">
                or update_date = #{updateDate}
            </if>
            <if test="counter != null">
                or counter = #{counter}
            </if>
            <if test="ostate != null">
                or ostate = #{ostate}
            </if>
        </where>
    </select>

    <!-- 新增所有列 -->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into purchase_order(id, delicery_date, vendor_name, documents_date, vetting_name, disrate, dismoney,
                                   offers_price, order_state, depot_name, receipt_order_id, exit_order_id,
                                   payment_order, vetting_state, last_vetting_date, inbound_state, buyer_name,
                                   create_people,create_date, update_date, counter, ostate)
        values (#{id}, #{deliceryDate}, #{vendorName}, #{documentsDate}, #{vettingName}, #{disrate}, #{dismoney},
                #{offersPrice}, #{orderState}, #{depotName}, #{receiptOrderId}, #{exitOrderId}, #{paymentOrder},
                #{vettingState}, #{lastVettingDate}, #{inboundState}, #{buyerName}, #{createPeople},
                #{createDate}, #{updateDate}, #{counter}, #{ostate})
    </insert>

    <!-- 批量新增 -->
    <insert id="insertBatch">
        insert into purchase_order(id, delicery_date, vendor_name, documents_date, vetting_name, disrate, dismoney,
        offers_price, order_state, depot_name, receipt_order_id, exit_order_id, payment_order, vetting_state,
        last_vetting_date, inbound_state, buyer_name, create_people, create_date, update_date, counter, ostate)
        values
        <foreach collection="purchaseOrders" item="item" index="index" separator=",">
            (
            #{item.id}, #{item.deliceryDate}, #{item.vendorName}, #{item.documentsDate}, #{item.vettingName},
            #{item.disrate}, #{item.dismoney}, #{item.offersPrice}, #{item.orderState}, #{item.depotName},
            #{item.receiptOrderId}, #{item.exitOrderId}, #{item.paymentOrder}, #{item.vettingState},
            #{item.lastVettingDate}, #{item.inboundState}, #{item.buyerName}, #{item.createPeople},
            #{item.createDate}, #{item.updateDate}, #{item.counter}, #{item.ostate} )
        </foreach>
    </insert>

    <!-- 通过主键修改数据 -->
    <update id="update">
        update frameproject.purchase_order
        <set>
            <if test="deliceryDate != null">
                delicery_date = #{deliceryDate},
            </if>
            <if test="vendorName != null and vendorName != ''">
                vendor_name = #{vendorName},
            </if>
            <if test="documentsDate != null">
                documents_date = #{documentsDate},
            </if>
            <if test="vettingName != null and vettingName != ''">
                vetting_name = #{vettingName},
            </if>
            <if test="disrate != null">
                disrate = #{disrate},
            </if>
            <if test="dismoney != null">
                dismoney = #{dismoney},
            </if>
            <if test="offersPrice != null">
                offers_price = #{offersPrice},
            </if>
            <if test="orderState != null">
                order_state = #{orderState},
            </if>
            <if test="depotName != null and depotName != ''">
                depot_name = #{depotName},
            </if>
            <if test="receiptOrderId != null and receiptOrderId != ''">
                receipt_order_id = #{receiptOrderId},
            </if>
            <if test="exitOrderId != null and exitOrderId != ''">
                exit_order_id = #{exitOrderId},
            </if>
            <if test="paymentOrder != null and paymentOrder != ''">
                payment_order = #{paymentOrder},
            </if>
            <if test="vettingState != null">
                vetting_state = #{vettingState},
            </if>
            <if test="lastVettingDate != null">
                last_vetting_date = #{lastVettingDate},
            </if>
            <if test="inboundState != null">
                inbound_state = #{inboundState},
            </if>
            <if test="buyerName != null and buyerName != ''">
                buyer_name = #{buyerName},
            </if>
            <if test="createPeople != null and createPeople != ''">
                create_people = #{createPeople},
            </if>
            <if test="createDate != null">
                create_date = #{createDate},
            </if>
            <if test="updateDate != null">
                update_date = #{updateDate},
            </if>
            <if test="counter != null">
                counter = #{counter},
            </if>
            <if test="ostate != null">
                ostate = #{ostate},
            </if>
        </set>
        where id = #{id}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById">
        delete
        from purchase_order
        where id = #{id}
    </delete>

    <!-- 总数 -->
    <select id="count" resultType="int">
        select count(*)
        from purchase_order
    </select>

    <select id="querythisPayment" resultMap="PurchaseReceipt">
        select *,offers_price-ostate from purchase_order where id=#{purchaseId}
    </select>

</mapper>
