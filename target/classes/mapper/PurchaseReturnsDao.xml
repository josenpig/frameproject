<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xingji.frameproject.mybatis.dao.PurchaseReturnsDao">
    <!-- 结果集 -->
    <resultMap type="com.xingji.frameproject.mybatis.entity.PurchaseReturns" id="PurchaseReturnsMap">
        <result property="id" column="id" jdbcType="VARCHAR"/>
        <result property="exitDate" column="exit_date" jdbcType="TIMESTAMP"/>
        <result property="vendorName" column="vendor_name" jdbcType="VARCHAR"/>
        <result property="buyerName" column="buyer_name" jdbcType="VARCHAR"/>
        <result property="depotName" column="depot_name" jdbcType="VARCHAR"/>
        <result property="offersPrice" column="offers_price" jdbcType="NUMERIC"/>
        <result property="vettingName" column="vetting_name" jdbcType="VARCHAR"/>
        <result property="lastVettingTime" column="last_vetting_time" jdbcType="TIMESTAMP"/>
        <result property="vettingState" column="vetting_state" jdbcType="INTEGER"/>
        <result property="createDate" column="create_date" jdbcType="TIMESTAMP"/>
        <result property="updateDate" column="update_date" jdbcType="TIMESTAMP"/>
        <result property="counter" column="counter" jdbcType="INTEGER"/>
        <result property="purchaseOrder" column="purchase_order" jdbcType="VARCHAR"/>
        <result property="receiptOrder" column="receipt_order" jdbcType="VARCHAR"/>
        <result property="paymentOrder" column="payment_order" jdbcType="VARCHAR"/>
        <result property="cavOrder" column="cav_order" jdbcType="VARCHAR"/>
    </resultMap>

    <!-- 基本字段 -->
    <sql id="Base_Column_List">
        id
        , exit_date, vendor_name, buyer_name, depot_name, offers_price, vetting_name, last_vetting_time, vetting_state, create_date, update_date, counter, purchase_order, receipt_order, payment_order, cav_order    </sql>

    <!-- 查询单个 -->
    <select id="selectById" resultMap="PurchaseReturnsMap">
        select
        <include refid="Base_Column_List"/>
        from purchase_returns
        where id = #{id}
    </select>

    <!-- 查询全部 -->
    <select id="selectAll" resultMap="PurchaseReturnsMap">
        select
        <include refid="Base_Column_List"/>
        from purchase_returns
    </select>

    <!--通过实体作为筛选条件查询-->
    <select id="selectList" resultMap="PurchaseReturnsMap">
        select
        <include refid="Base_Column_List"/>
        from purchase_returns
        <where>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
            <if test="exitDate != null">
                and exit_date = #{exitDate}
            </if>
            <if test="vendorName != null and vendorName != ''">
                and vendor_name = #{vendorName}
            </if>
            <if test="buyerName != null and buyerName != ''">
                and buyer_name = #{buyerName}
            </if>
            <if test="depotName != null and depotName != ''">
                and depot_name = #{depotName}
            </if>
            <if test="offersPrice != null">
                and offers_price = #{offersPrice}
            </if>
            <if test="vettingName != null and vettingName != ''">
                and vetting_name = #{vettingName}
            </if>
            <if test="lastVettingTime != null">
                and last_vetting_time = #{lastVettingTime}
            </if>
            <if test="vettingState != null">
                and vetting_state = #{vettingState}
            </if>
            <if test="contact != null and contact != ''">
                and contact = #{contact}
            </if>
            <if test="createDate != null">
                and create_date = #{createDate}
            </if>
            <if test="updateDate != null">
                and update_date = #{updateDate}
            </if>
            <if test="counter != null">
                and counter = #{counter}
            </if>
            <if test="purchaseOrder != null and purchaseOrder != ''">
                and purchase_order = #{purchaseOrder}
            </if>
            <if test="receiptOrder != null and receiptOrder != ''">
                and receipt_order = #{receiptOrder}
            </if>
            <if test="paymentOrder != null and paymentOrder != ''">
                and payment_order = #{paymentOrder}
            </if>
            <if test="cavOrder != null and cavOrder != ''">
                and cav_order = #{cavOrder}
            </if>
        </where>
    </select>

    <!-- 新增所有列 -->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into purchase_returns(id, exit_date, vendor_name, buyer_name, depot_name, offers_price, vetting_name,
                                     last_vetting_time, vetting_state, state,create_date, update_date, counter,
                                     purchase_order, receipt_order, payment_order, cav_order)
        values (#{id}, #{exitDate}, #{vendorName}, #{buyerName}, #{depotName}, #{offersPrice}, #{vettingName},
                #{lastVettingTime}, #{vettingState}, #{state}, #{createDate}, #{updateDate}, #{counter},
                #{purchaseOrder}, #{receiptOrder}, #{paymentOrder}, #{cavOrder})
    </insert>

    <!-- 批量新增 -->
    <insert id="batchInsert">
        insert into purchase_returns(id, exit_date, vendor_name, buyer_name, depot_name, offers_price, vetting_name,
        last_vetting_time, vetting_state, contact, create_date, update_date, counter, purchase_order, receipt_order,
        payment_order, cav_order)
        values
        <foreach collection="purchaseReturnss" item="item" index="index" separator=",">
            (
            #{item.id}, #{item.exitDate}, #{item.vendorName}, #{item.buyerName}, #{item.depotName}, #{item.offersPrice},
            #{item.vettingName}, #{item.lastVettingTime}, #{item.vettingState}, #{item.contact}, #{item.createDate},
            #{item.updateDate}, #{item.counter}, #{item.purchaseOrder}, #{item.receiptOrder}, #{item.paymentOrder},
            #{item.cavOrder} )
        </foreach>
    </insert>

    <!-- 通过主键修改数据 -->
    <update id="update">
        update frameproject.purchase_returns
        <set>
            <if test="exitDate != null">
                exit_date = #{exitDate},
            </if>
            <if test="vendorName != null and vendorName != ''">
                vendor_name = #{vendorName},
            </if>
            <if test="buyerName != null and buyerName != ''">
                buyer_name = #{buyerName},
            </if>
            <if test="depotName != null and depotName != ''">
                depot_name = #{depotName},
            </if>
            <if test="offersPrice != null">
                offers_price = #{offersPrice},
            </if>
            <if test="vettingName != null and vettingName != ''">
                vetting_name = #{vettingName},
            </if>
            <if test="lastVettingTime != null">
                last_vetting_time = #{lastVettingTime},
            </if>
            <if test="vettingState != null">
                vetting_state = #{vettingState},
            </if>
            <if test="contact != null and contact != ''">
                contact = #{contact},
            </if>
            <if test="createDate != null">
                create_date = #{createDate},
            </if>
            <if test="updateDate != null">
                update_date = #{updateDate},
            </if>
            <if test="counter != null">
                counter = #{counter},
            </if>
            <if test="purchaseOrder != null and purchaseOrder != ''">
                purchase_order = #{purchaseOrder},
            </if>
            <if test="receiptOrder != null and receiptOrder != ''">
                receipt_order = #{receiptOrder},
            </if>
            <if test="paymentOrder != null and paymentOrder != ''">
                payment_order = #{paymentOrder},
            </if>
            <if test="cavOrder != null and cavOrder != ''">
                cav_order = #{cavOrder},
            </if>
        </set>
        where id = #{id}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById">
        delete
        from purchase_returns
        where id = #{id}
    </delete>

    <!-- 总数 -->
    <select id="count" resultType="int">
        select count(*)
        from purchase_returns
    </select>


    <select id="conditionpage" resultMap="PurchaseReturnsMap">
        select
        <include refid="Base_Column_List"/>
        from purchase_returns
        <where>
            <if test="orderId != null and orderId != ''">
                and id like CONCAT('%',#{orderId},'%')
            </if>
            <if test="inBoundDate != null and inBoundDate=='今天'" >
                and to_days(exit_date) = to_days(now())
            </if>
            <if test="inBoundDate != null and inBoundDate=='昨天'" >
                and to_days(now())-to_days(exit_date) = 1
            </if>
            <if test="inBoundDate != null and inBoundDate=='本周'" >
                and DATE_SUB(CURDATE(), INTERVAL 7 DAY) &lt;= date(exit_date)
            </if>
            <if test="inBoundDate != null and inBoundDate=='本月'" >
                and DATE_FORMAT( exit_date, '%Y%m' ) = DATE_FORMAT( CURDATE( ) , '%Y%m' )
            </if>
            <if test="inBoundDate != null and inBoundDate != '' and inBoundDate=='自定义' and dtimeState!=null and dtimeEnd!=null">
                and DATE_FORMAT(exit_date,'%Y-%m-%d') BETWEEN DATE_FORMAT(#{dtimeState},'%Y-%m-%d')
                AND DATE_FORMAT(#{dtimeEnd},'%Y-%m-%d')
            </if>
            <if test="vendorName != null and vendorName != ''">
                and vendor_name = #{vendorName}
            </if>
            <if test="buyerName != null and buyerName != ''">
                and buyer_name = #{buyerName}
            </if>

            <if test="vettingState != null and vettingState == '草稿'" >
                and vetting_state = -2
            </if>
            <if test="vettingState != null and vettingState == '待审批'" >
                and vetting_state = 0
            </if>
            <if test="vettingState != null and vettingState == '已驳回'" >
                and vetting_state = -1
            </if>
            <if test="vettingState != null and vettingState == '审批通过'" >
                and vetting_state = 1
            </if>

        </where>
        ORDER by create_date DESC
    </select>
</mapper>
